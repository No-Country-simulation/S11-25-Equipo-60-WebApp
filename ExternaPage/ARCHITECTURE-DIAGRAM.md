# ๐ Arquitectura Visual - UserMenu Component

## ๐๏ธ Diagrama de Componentes

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                          UserMenu (Root)                         โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ const { userId, role, logout } = useAuthStore()            โ โ
โ  โ const { t } = useTranslation()                             โ โ
โ  โ const initials = useUserInitials(userId)                   โ โ
โ  โ const { menuOptions } = useUserMenu({ logout, t })         โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                                   โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โ  โ                    DropdownMenu                            โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ  โ
โ  โ  โ             DropdownMenuTrigger                       โ โ  โ
โ  โ  โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ  โ
โ  โ  โ   โ          UserAvatar                            โ โ โ  โ
โ  โ  โ   โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ โ  โ
โ  โ  โ   โ  โ Avatar with Gradient Background          โ โ โ โ  โ
โ  โ  โ   โ  โ Initials: {initials} (e.g., "U1")        โ โ โ โ  โ
โ  โ  โ   โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ โ  โ
โ  โ  โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ  โ
โ  โ  โ             DropdownMenuContent                       โ โ  โ
โ  โ  โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ  โ
โ  โ  โ   โ        DropdownMenuLabel                      โ โ โ  โ
โ  โ  โ   โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ โ  โ
โ  โ  โ   โ  โ            UserInfo                      โ โ โ โ  โ
โ  โ  โ   โ  โ  - Display: "Usuario #123"               โ โ โ โ  โ
โ  โ  โ   โ  โ  - Role: "Administrador"                 โ โ โ โ  โ
โ  โ  โ   โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ โ  โ
โ  โ  โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ  โ
โ  โ  โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ  โ
โ  โ  โ   โ        DropdownMenuSeparator                  โ โ โ  โ
โ  โ  โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ  โ
โ  โ  โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ  โ
โ  โ  โ   โ          UserMenuItems                        โ โ โ  โ
โ  โ  โ   โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ โ  โ
โ  โ  โ   โ  โ ๐ค Perfil    โ /dashboard/perfil         โ โ โ โ  โ
โ  โ  โ   โ  โ โ๏ธ  Configuraciรณn โ /dashboard/config     โ โ โ โ  โ
โ  โ  โ   โ  โ ๐ช Cerrar sesiรณn โ logout + /login       โ โ โ โ  โ
โ  โ  โ   โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ โ  โ
โ  โ  โ   โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ โ  โ
โ  โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ  โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ  โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Flujo de Datos

```
โโโโโโโโโโโโโโโโโโโโ
โ   Auth Store     โ
โ  (Zustand)       โ
โ                  โ
โ โข userId: 123    โ
โ โข role: "admin"  โ
โ โข logout()       โ
โโโโโโโโโโฌโโโโโโโโโโ
         โ
         โ useAuthStore()
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ           UserMenu                   โ
โ                                      โ
โ  userId โโโโโโโโโฌโโโโโโโโโโโโโโโโโโ  โ
โ                 โ                 โ  โ
โ                 โผ                 โผ  โ
โ          useUserInitials()   UserInfoโ
โ                 โ                    โ
โ                 โผ                    โ
โ            initials="U1"             โ
โ                 โ                    โ
โ                 โผ                    โ
โ            UserAvatar                โ
โ                                      โ
โ  logout โโโโโโโโโ                    โ
โ       t โโโโโโโโโค                    โ
โ                 โ                    โ
โ                 โผ                    โ
โ           useUserMenu()              โ
โ                 โ                    โ
โ                 โผ                    โ
โ           menuOptions[]              โ
โ                 โ                    โ
โ                 โผ                    โ
โ          UserMenuItems               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฏ Separaciรณn de Responsabilidades

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      PRESENTATION LAYER                      โ
โ  (Componentes UI - Solo renderizado)                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โข UserMenu.tsx      โ Orquesta componentes                 โ
โ  โข UserAvatar.tsx    โ Muestra avatar                       โ
โ  โข UserInfo.tsx      โ Muestra informaciรณn                  โ
โ  โข UserMenuItems.tsx โ Renderiza items                      โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โฒ
                              โ
                    Usa hooks para lรณgica
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                       BUSINESS LOGIC                         โ
โ  (Custom Hooks - Lรณgica de negocio)                        โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โข useUserInitials.ts โ Genera iniciales                    โ
โ  โข useUserMenu.ts     โ Gestiona navegaciรณn/logout          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โฒ
                              โ
                      Consume estado global
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                        STATE LAYER                           โ
โ  (Zustand Store - Estado global)                           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โข auth.store.ts โ userId, role, tokens, logout()           โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โฒ
                              โ
                      Llama al backend
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                         API LAYER                            โ
โ  (API Calls - Comunicaciรณn con backend)                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  โข login()     โ POST /api/auth/login/                      โ
โ  โข logout()    โ POST /api/auth/logout/                     โ
โ  โข refresh()   โ POST /api/auth/token/refresh/              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ Integraciรณn con Auth Store

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    auth.store.ts                             โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                     State Data                          โ โ
โ  โ  โข userId: number | null                                โ โ
โ  โ  โข role: string | null                                  โ โ
โ  โ  โข accessToken: string | null                           โ โ
โ  โ  โข refreshToken: string | null                          โ โ
โ  โ  โข isAuthenticated: boolean                             โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                     Actions                             โ โ
โ  โ  โข loginUser(credentials)  โ Promise<void>              โ โ
โ  โ  โข logout()                 โ Promise<void>             โ โ
โ  โ  โข refresh()                โ Promise<void>             โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ                                                               โ
โ  Persisted in IndexedDB via Zustand middleware               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โฒ
                              โ
                              โ Subscription
                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      UserMenu Component                      โ
โ                                                               โ
โ  const { userId, role, logout } = useAuthStore()             โ
โ                                                               โ
โ  Auto re-renders when store changes                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐จ Composiciรณn de Componentes (Composition Pattern)

```
UserMenu
    โ
    โโโโ DropdownMenu (shadcn/ui)
    โ       โ
    โ       โโโโ DropdownMenuTrigger
    โ       โ       โโโโ Button (variant="ghost")
    โ       โ               โโโโ UserAvatar
    โ       โ                       โโโโ Avatar
    โ       โ                               โโโโ AvatarFallback
    โ       โ                                       โโโโ initials
    โ       โ
    โ       โโโโ DropdownMenuContent
    โ               โโโโ DropdownMenuLabel
    โ               โ       โโโโ UserInfo
    โ               โ               โโโโ userId display
    โ               โ               โโโโ role display
    โ               โ
    โ               โโโโ DropdownMenuSeparator
    โ               โ
    โ               โโโโ UserMenuItems
    โ                       โโโโ map(menuOptions)
    โ                               โโโโ DropdownMenuItem
    โ                                       โโโโ Icon (Lucide)
    โ                                       โโโโ Label (translated)
```

---

## ๐ Patrones de Diseรฑo Aplicados

### 1. Strategy Pattern (en useUserMenu)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    useUserMenu Hook                          โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                   Strategy: Profile                     โ โ
โ  โ  onClick: () => router.push('/dashboard/perfil')        โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                   Strategy: Settings                    โ โ
โ  โ  onClick: () => router.push('/dashboard/configuracion') โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โ  โ                   Strategy: Logout                      โ โ
โ  โ  onClick: async () => {                                 โ โ
โ  โ    await logout()                                       โ โ
โ  โ    router.push('/login')                                โ โ
โ  โ  }                                                       โ โ
โ  โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 2. Factory Pattern (Menu Options)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Menu Options Factory                      โ
โ                                                               โ
โ  Input: { logout, t }                                        โ
โ     โ                                                         โ
โ     โผ                                                         โ
โ  useMemo(() => [                                             โ
โ    createProfileOption(t),     โโโโโโโโโโโ                  โ
โ    createSettingsOption(t),    โโโโโโโโโโโคโโโโบ menuOptions  โ
โ    createLogoutOption(logout, t) โโโโโโโโโ                  โ
โ  ])                                                           โ
โ     โ                                                         โ
โ     โผ                                                         โ
โ  Output: UserMenuOption[]                                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

### 3. Observer Pattern (Zustand)

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                      Auth Store (Subject)                    โ
โ                                                               โ
โ  State Changes:                                              โ
โ  โข login()  โ userId = 123, role = "admin"                   โ
โ  โข logout() โ userId = null, role = null                     โ
โโโโโโโโโโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                         โ
                         โ Notifies subscribers
                         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                  UserMenu (Observer)                         โ
โ                                                               โ
โ  Automatically re-renders when:                              โ
โ  โข userId changes                                            โ
โ  โข role changes                                              โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

---

## ๐ฆ Dependencias y Imports

```
UserMenu.tsx
    โโโ @/components/ui/button
    โโโ @/components/ui/dropdown-menu
    โโโ @/store (useAuthStore)
    โโโ @/provider (useTranslation)
    โโโ ../hooks/useUserInitials
    โโโ ../hooks/useUserMenu
    โโโ ./UserAvatar
    โโโ ./UserInfo
    โโโ ./UserMenuItems
    โโโ ../constants/menu.constants

useUserMenu.ts
    โโโ react (useCallback, useMemo)
    โโโ next/navigation (useRouter)
    โโโ lucide-react (LogOut, Settings, User)
    โโโ ../types/user.types
    โโโ ../constants/menu.constants

useUserInitials.ts
    โโโ react (useMemo)
    โโโ ../constants/menu.constants

UserInfo.tsx
    โโโ (no external deps - pure presentation)

UserAvatar.tsx
    โโโ @/components/ui/avatar
```

---

## ๐งฉ รrbol de Props

```
UserMenu (Root)
    โ
    โโโโ UserAvatar
    โ       โโโโ initials: string (from useUserInitials)
    โ
    โโโโ UserInfo
    โ       โโโโ userId: number | null (from useAuthStore)
    โ       โโโโ role: string | null (from useAuthStore)
    โ       โโโโ t: (key: string) => string (from useTranslation)
    โ
    โโโโ UserMenuItems
            โโโโ options: UserMenuOption[] (from useUserMenu)
                    โโโโ [{
                          id: string,
                          label: string,
                          icon: ComponentType,
                          onClick: () => void,
                          variant?: "default" | "destructive"
                        }]
```

---

## ๐ Type Flow

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    Type Definitions                          โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
                โ             โ             โ
                โผ             โผ             โผ
    โโโโโโโโโโโโโโโโโโ  โโโโโโโโโโโโ  โโโโโโโโโโโโโโ
    โ   AuthUser     โ  โ MenuOpt  โ  โ UserDisp   โ
    โโโโโโโโโโโโโโโโโโค  โโโโโโโโโโโโค  โโโโโโโโโโโโโโค
    โ userId: number โ  โ id       โ  โ displayNameโ
    โ role: string   โ  โ label    โ  โ initials   โ
    โโโโโโโโโโโโโโโโโโ  โ icon     โ  โ role       โ
                        โ onClick  โ  โโโโโโโโโโโโโโ
                        โ variant  โ
                        โโโโโโโโโโโโ
                              โ
                Used by โโโโโโโผโโโโโโ Used by
                              โ
                โโโโโโโโโโโโโโโดโโโโโโโโโโโโโโ
                โ                           โ
                โผ                           โผ
        โโโโโโโโโโโโโโโโ           โโโโโโโโโโโโโโโโ
        โ useUserMenu  โ           โ UserMenuItemsโ
        โโโโโโโโโโโโโโโโ           โโโโโโโโโโโโโโโโ
```

---

**รltima actualizaciรณn:** 10 de Diciembre, 2025  
**Versiรณn:** 2.0.0  
**Estado:** โ Production Ready
